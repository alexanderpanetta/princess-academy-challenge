<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Princess Academy Challenge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@600;700&display=swap');

        body {
            font-family: 'Nunito', 'Georgia', serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }

        .game-container {
            width: 900px;
            height: 650px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
            position: relative;
        }

        .screen {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            text-align: center;
            position: absolute;
            top: 0;
            left: 0;
            background-size: 100% 100%;
            background-position: center;
            background-repeat: no-repeat;
        }

        .screen.active {
            display: flex;
        }

        /* Title Screen */
        #title-screen {
            background-image: url('images/title-screen.png');
            justify-content: flex-end;
            padding-bottom: 60px;
        }

        .title-content {
            background: rgba(255,255,255,0.95);
            padding: 25px 40px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        #title-screen h1 {
            font-family: 'Fredoka One', cursive;
            font-size: 36px;
            color: #C71585;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 10px;
        }

        #title-screen .subtitle {
            font-size: 18px;
            color: #8B4513;
            margin-bottom: 20px;
        }

        .princess-avatar {
            width: 100px;
            height: 120px;
            margin: 0 auto 15px;
        }

        .princess-avatar img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .btn {
            padding: 12px 35px;
            font-size: 20px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        .btn-primary {
            background: linear-gradient(180deg, #FF69B4 0%, #C71585 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(199,21,133,0.4);
            border: 3px solid #FFB6C1;
        }

        .btn-answer {
            width: 100%;
            padding: 14px 20px;
            font-size: 18px;
            margin: 6px 0;
            background: linear-gradient(180deg, #FFF0F5 0%, #FFB6C1 100%);
            color: #8B008B;
            border: 3px solid #DDA0DD;
            border-radius: 15px;
        }

        .btn-answer:hover {
            background: linear-gradient(180deg, #FFB6C1 0%, #FF69B4 100%);
            color: white;
            border-color: #C71585;
        }

        .btn-answer.correct {
            background: linear-gradient(180deg, #90EE90 0%, #32CD32 100%);
            color: white;
            border-color: #228B22;
        }

        .btn-answer.incorrect {
            background: linear-gradient(180deg, #FFB6C1 0%, #FF6B6B 100%);
            color: white;
            border-color: #DC143C;
        }

        /* Question Screen */
        .question-screen-reading {
            background-image: url('images/library.png');
        }

        .question-screen-math {
            background-image: url('images/treasury.png');
        }

        .question-panel {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 25px 35px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            border: 4px solid #DDA0DD;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0e6fa;
            border-radius: 10px;
            margin-bottom: 15px;
            overflow: hidden;
            border: 2px solid #DDA0DD;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF69B4, #C71585);
            transition: width 0.3s;
            border-radius: 10px;
        }

        .challenge-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .helper-icon {
            width: 60px;
            height: 60px;
        }

        .helper-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .challenge-title {
            font-family: 'Fredoka One', cursive;
            font-size: 24px;
            color: #C71585;
        }

        .question-counter {
            font-size: 16px;
            color: #8B4513;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 20px;
            color: #4B0082;
            margin-bottom: 20px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.4;
        }

        .answers-container {
            width: 100%;
        }

        /* Transition Screen */
        #transition-screen {
            background-image: url('images/library.png');
        }

        .transition-panel {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 35px 50px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            border: 4px solid #DDA0DD;
        }

        #transition-screen h2 {
            font-family: 'Fredoka One', cursive;
            font-size: 32px;
            color: #C71585;
            margin-bottom: 15px;
        }

        #transition-screen p {
            font-size: 20px;
            color: #8B4513;
            margin-bottom: 10px;
        }

        .score-display {
            font-family: 'Fredoka One', cursive;
            font-size: 36px;
            color: #4B0082;
            margin: 15px 0;
        }

        .next-challenge-text {
            font-size: 18px;
            color: #6B4423;
            margin: 20px 0;
        }

        /* Results Screen */
        #results-screen {
            background-image: url('images/victory.png');
        }

        .results-panel {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px 50px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            border: 4px solid #FFD700;
        }

        #results-screen h2 {
            font-family: 'Fredoka One', cursive;
            font-size: 36px;
            color: #C71585;
            margin-bottom: 15px;
        }

        .final-score {
            font-size: 22px;
            color: #4B0082;
            margin-bottom: 15px;
        }

        .score-breakdown {
            font-size: 16px;
            color: #8B4513;
            margin-bottom: 20px;
        }

        .medal-container {
            width: 120px;
            height: 140px;
            margin: 15px auto;
        }

        .medal-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));
        }

        .medal-text {
            font-family: 'Fredoka One', cursive;
            font-size: 26px;
            color: #8B4513;
            margin-bottom: 20px;
        }

        .celebration {
            font-size: 40px;
            margin-bottom: 10px;
        }

        /* Medal-specific colors */
        .gold .results-panel { border-color: #FFD700; }
        .gold .medal-text { color: #DAA520; }

        .silver .results-panel { border-color: #C0C0C0; }
        .silver .medal-text { color: #808080; }

        .bronze .results-panel { border-color: #CD7F32; }
        .bronze .medal-text { color: #8B4513; }

        .no-medal .results-panel { border-color: #DDA0DD; }
        .no-medal .medal-text { color: #C71585; }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Title Screen -->
        <div id="title-screen" class="screen active">
            <div class="title-content">
                <div class="princess-avatar">
                    <img src="images/princess.png" alt="Princess">
                </div>
                <h1>Princess Academy Challenge</h1>
                <p class="subtitle">Become a Certified Royal Scholar!</p>
                <button class="btn btn-primary" onclick="startGame()">Start Challenge</button>
            </div>
        </div>

        <!-- Question Screen -->
        <div id="question-screen" class="screen question-screen-reading">
            <div class="question-panel">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="challenge-header">
                    <div class="helper-icon" id="helper-icon">
                        <img src="images/owl.png" alt="Helper">
                    </div>
                    <h2 class="challenge-title" id="challenge-title">The Royal Library</h2>
                </div>
                <p class="question-counter" id="question-counter">Question 1 of 5</p>
                <div class="question-text" id="question-text">
                    What is the question?
                </div>
                <div class="answers-container" id="answers-container">
                    <!-- Answers will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Transition Screen -->
        <div id="transition-screen" class="screen">
            <div class="transition-panel">
                <h2>Reading Complete!</h2>
                <p>You scored:</p>
                <div class="score-display" id="reading-score-display">0 out of 5</div>
                <p class="next-challenge-text">Now let's head to the Royal Treasury!</p>
                <div class="helper-icon" style="margin: 20px auto;">
                    <img src="images/dwarf.png" alt="Dwarf">
                </div>
                <button class="btn btn-primary" onclick="startMathChallenge()">Start Math Challenge</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <div class="results-panel">
                <div class="celebration" id="celebration"></div>
                <h2>Challenge Complete!</h2>
                <div class="final-score" id="final-score">You scored 8 out of 10!</div>
                <div class="score-breakdown" id="score-breakdown">Reading: 4/5 | Math: 4/5</div>
                <div class="medal-container" id="medal-container">
                    <img src="images/gold-medal.png" alt="Medal" id="medal-image">
                </div>
                <p class="medal-text" id="medal-text">Gold Medal!</p>
                <button class="btn btn-primary" onclick="restartGame()">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // Audio Context for music
        let audioContext = null;

        function getAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }

        function playNote(frequency, startTime, duration, type = 'sine', volume = 0.3) {
            const ctx = getAudioContext();
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);

            oscillator.frequency.value = frequency;
            oscillator.type = type;

            gainNode.gain.setValueAtTime(volume, startTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + duration - 0.05);

            oscillator.start(startTime);
            oscillator.stop(startTime + duration);
        }

        function playVictoryMusic() {
            // Happy triumphant fanfare for Gold/Silver
            const ctx = getAudioContext();
            const now = ctx.currentTime;

            // C major triumphant melody
            const notes = [
                { freq: 523.25, time: 0, dur: 0.2 },     // C5
                { freq: 659.25, time: 0.2, dur: 0.2 },   // E5
                { freq: 783.99, time: 0.4, dur: 0.2 },   // G5
                { freq: 1046.50, time: 0.6, dur: 0.4 },  // C6
                { freq: 783.99, time: 1.0, dur: 0.2 },   // G5
                { freq: 1046.50, time: 1.2, dur: 0.6 },  // C6 (held)
            ];

            notes.forEach(note => {
                playNote(note.freq, now + note.time, note.dur, 'triangle', 0.4);
            });

            // Add harmony
            const harmony = [
                { freq: 261.63, time: 0, dur: 0.8 },     // C4
                { freq: 329.63, time: 0, dur: 0.8 },     // E4
                { freq: 392.00, time: 0.8, dur: 1.0 },   // G4
                { freq: 523.25, time: 0.8, dur: 1.0 },   // C5
            ];

            harmony.forEach(note => {
                playNote(note.freq, now + note.time, note.dur, 'sine', 0.2);
            });
        }

        function playOkayMusic() {
            // Moderate, encouraging tune for Bronze
            const ctx = getAudioContext();
            const now = ctx.currentTime;

            const notes = [
                { freq: 392.00, time: 0, dur: 0.3 },     // G4
                { freq: 440.00, time: 0.3, dur: 0.3 },   // A4
                { freq: 493.88, time: 0.6, dur: 0.3 },   // B4
                { freq: 523.25, time: 0.9, dur: 0.5 },   // C5
            ];

            notes.forEach(note => {
                playNote(note.freq, now + note.time, note.dur, 'triangle', 0.3);
            });
        }

        function playSadMusic() {
            // Gentle, encouraging "try again" melody
            const ctx = getAudioContext();
            const now = ctx.currentTime;

            // Descending minor melody
            const notes = [
                { freq: 392.00, time: 0, dur: 0.4 },     // G4
                { freq: 349.23, time: 0.4, dur: 0.4 },   // F4
                { freq: 329.63, time: 0.8, dur: 0.4 },   // E4
                { freq: 293.66, time: 1.2, dur: 0.6 },   // D4
            ];

            notes.forEach(note => {
                playNote(note.freq, now + note.time, note.dur, 'sine', 0.25);
            });
        }

        // Game State
        let currentQuestion = 0;
        let currentChallenge = 'reading';
        let readingScore = 0;
        let mathScore = 0;
        let answeredCurrent = false;
        let selectedReadingQuestions = [];
        let selectedMathQuestions = [];

        // Reading Question Pool - 25 questions (5 per slot) - WITH EDUCATIONAL FACTS
        const readingQuestionPool = [
            // Slot 1: Simple inference with world/art/science facts
            [
                {
                    question: "Read: 'Leonardo da Vinci painted the Mona Lisa in Italy. It is one of the most famous paintings in the world! People smile when they see her mysterious face.' How do people feel when they see the Mona Lisa?",
                    answers: ["Sad", "Happy", "Scared", "Angry"],
                    correct: 1
                },
                {
                    question: "Read: 'The Eiffel Tower is a very tall tower in Paris, France. Visitors climb to the top and see the whole city! They clap their hands with joy.' How do visitors feel at the top?",
                    answers: ["Angry", "Scared", "Excited", "Sleepy"],
                    correct: 2
                },
                {
                    question: "Read: 'Astronauts travel to space in rockets. When they look at Earth from space, they see blue oceans and green land. They smile because Earth is so beautiful.' How do astronauts feel when they see Earth?",
                    answers: ["Sad", "Amazed", "Angry", "Bored"],
                    correct: 1
                },
                {
                    question: "Read: 'Dolphins are very smart animals that live in the ocean. They jump and play in the waves all day long.' How do dolphins seem to feel?",
                    answers: ["Sad", "Tired", "Happy", "Scared"],
                    correct: 2
                },
                {
                    question: "Read: 'The Pyramids in Egypt are very, very old. They were built thousands of years ago! When people see how big they are, their eyes get wide and their mouths drop open.' How do people feel when they see the Pyramids?",
                    answers: ["Bored", "Amazed", "Angry", "Sleepy"],
                    correct: 1
                }
            ],
            // Slot 2: Vocabulary with educational context
            [
                {
                    question: "Read: 'The elephant is the largest animal that lives on land. It is bigger than a car!' What does 'largest' mean?",
                    answers: ["Smallest", "Biggest", "Fastest", "Loudest"],
                    correct: 1
                },
                {
                    question: "Read: 'The cheetah is the fastest animal on land. It can run faster than a car!' What does 'fastest' mean?",
                    answers: ["Slowest", "Quickest", "Tallest", "Smallest"],
                    correct: 1
                },
                {
                    question: "Read: 'The ocean is very deep. Giant whales swim in the deep, dark water far below.' What does 'deep' mean?",
                    answers: ["Shallow", "Goes down far", "Very wide", "Very warm"],
                    correct: 1
                },
                {
                    question: "Read: 'The ancient Colosseum in Rome is very, very old. Ancient means from a long, long time ago.' What does 'ancient' mean?",
                    answers: ["Brand new", "Very old", "Very big", "Very pretty"],
                    correct: 1
                },
                {
                    question: "Read: 'The rainforest is a lush place with many, many trees, plants, and animals. Lush means full of green, growing things.' What does 'lush' mean?",
                    answers: ["Empty and dry", "Full of plants", "Very cold", "Very dark"],
                    correct: 1
                }
            ],
            // Slot 3: Cause and effect with world/science facts
            [
                {
                    question: "Read: 'Penguins live in very cold places like Antarctica. They have thick feathers so they can stay warm.' Why do penguins have thick feathers?",
                    answers: ["To look pretty", "To stay warm", "To swim faster", "To fly better"],
                    correct: 1
                },
                {
                    question: "Read: 'Sunflowers turn to face the sun during the day because they need sunlight to grow.' Why do sunflowers turn toward the sun?",
                    answers: ["They are dancing", "They need sunlight", "They are tired", "They hear music"],
                    correct: 1
                },
                {
                    question: "Read: 'The Moon has no air to breathe. Astronauts must wear special space suits so they can breathe on the Moon.' Why do astronauts wear space suits on the Moon?",
                    answers: ["To look cool", "To stay warm only", "So they can breathe", "To run faster"],
                    correct: 2
                },
                {
                    question: "Read: 'Many tourists visit Rome, Italy because it has beautiful old buildings like the Colosseum.' Why do tourists visit Rome?",
                    answers: ["It is always snowing", "It has beautiful old buildings", "It has no people", "It is very small"],
                    correct: 1
                },
                {
                    question: "Read: 'A caterpillar makes a cocoon so it can change into a beautiful butterfly!' Why does a caterpillar make a cocoon?",
                    answers: ["To hide from rain", "To take a short nap", "To change into a butterfly", "To eat more leaves"],
                    correct: 2
                }
            ],
            // Slot 4: Main idea with world/art/science topics
            [
                {
                    question: "Read: 'The Earth goes around the Sun. The Moon goes around the Earth. It takes one whole year for Earth to travel around the Sun.' What is this about?",
                    answers: ["The ocean", "Food", "Space and planets", "Animals"],
                    correct: 2
                },
                {
                    question: "Read: 'Italy is shaped like a boot! Rome is the capital city. Delicious pizza and pasta come from Italy.' What is this about?",
                    answers: ["France", "Italy", "Spain", "England"],
                    correct: 1
                },
                {
                    question: "Read: 'Lions live in Africa. Male lions have big fluffy manes. Lions are called the King of the Animals.' What is this about?",
                    answers: ["Elephants", "Tigers", "Lions", "Bears"],
                    correct: 2
                },
                {
                    question: "Read: 'Claude Monet loved to paint flowers and water. He painted beautiful gardens with water lilies. His paintings are in museums around the world.' What is this about?",
                    answers: ["A chef", "A doctor", "A teacher", "An artist"],
                    correct: 3
                },
                {
                    question: "Read: 'The ocean is full of amazing creatures. Colorful coral reefs are underwater homes for fish. Whales and dolphins swim in the deep blue sea.' What is this about?",
                    answers: ["The mountains", "The desert", "The ocean", "The forest"],
                    correct: 2
                }
            ],
            // Slot 5: Story comprehension with educational facts
            [
                {
                    question: "Read: 'The Leaning Tower of Pisa is a famous tower in Italy. It is white and it leans to one side! Many people take funny photos pretending to hold it up.' What color is the Leaning Tower of Pisa?",
                    answers: ["Red", "Blue", "White", "Green"],
                    correct: 2
                },
                {
                    question: "Read: 'Mars is called the Red Planet because it looks red in the sky. Venus is another planet that is very, very hot.' What color is Mars?",
                    answers: ["Blue", "Green", "Yellow", "Red"],
                    correct: 3
                },
                {
                    question: "Read: 'Big Ben is a famous clock tower in London, England. Inside the tower is a giant bell. When the bell rings, it goes BONG, BONG!' What is inside Big Ben?",
                    answers: ["A slide", "A giant bell", "A swimming pool", "A kitchen"],
                    correct: 1
                },
                {
                    question: "Read: 'Cleopatra was a powerful queen of Egypt long, long ago. She lived near the Nile River. The Nile is the longest river in Africa!' What river did Cleopatra live near?",
                    answers: ["The Amazon", "The Nile", "The Thames", "The Seine"],
                    correct: 1
                },
                {
                    question: "Read: 'Giant pandas live in China. They eat bamboo plants every single day. Pandas are black and white and very fluffy!' What do pandas eat?",
                    answers: ["Pizza", "Fish", "Bamboo", "Apples"],
                    correct: 2
                }
            ]
        ];

        // Math Question Pool - 25 questions (5 per slot) - EASIER
        const mathQuestionPool = [
            // Slot 1: Simple addition (sums up to 10)
            [
                {
                    question: "What is 3 + 4?",
                    answers: ["6", "7", "8", "9"],
                    correct: 1
                },
                {
                    question: "What is 5 + 2?",
                    answers: ["6", "7", "8", "9"],
                    correct: 1
                },
                {
                    question: "What is 4 + 5?",
                    answers: ["7", "8", "9", "10"],
                    correct: 2
                },
                {
                    question: "What is 6 + 3?",
                    answers: ["7", "8", "9", "10"],
                    correct: 2
                },
                {
                    question: "What is 2 + 6?",
                    answers: ["6", "7", "8", "9"],
                    correct: 2
                }
            ],
            // Slot 2: Simple subtraction (within 10)
            [
                {
                    question: "What is 8 - 3?",
                    answers: ["4", "5", "6", "7"],
                    correct: 1
                },
                {
                    question: "What is 7 - 2?",
                    answers: ["4", "5", "6", "7"],
                    correct: 1
                },
                {
                    question: "What is 9 - 4?",
                    answers: ["4", "5", "6", "7"],
                    correct: 1
                },
                {
                    question: "What is 10 - 3?",
                    answers: ["5", "6", "7", "8"],
                    correct: 2
                },
                {
                    question: "What is 6 - 2?",
                    answers: ["2", "3", "4", "5"],
                    correct: 2
                }
            ],
            // Slot 3: Word problems with educational facts
            [
                {
                    question: "The Colosseum in Rome, Italy is very old and famous! A tour guide shows 5 visitors the Colosseum. Then 3 more visitors join the tour. How many visitors are there now?",
                    answers: ["6", "7", "8", "9"],
                    correct: 2
                },
                {
                    question: "Giant pandas in China love to eat bamboo! A panda has 7 bamboo sticks. It eats 2 of them. How many bamboo sticks are left?",
                    answers: ["4", "5", "6", "7"],
                    correct: 1
                },
                {
                    question: "Saturn is a planet with beautiful rings around it! An astronaut counts 4 big rings and 3 small rings. How many rings did the astronaut count in all?",
                    answers: ["5", "6", "7", "8"],
                    correct: 2
                },
                {
                    question: "The Mona Lisa is a famous painting in a museum in Paris, France. On Monday, 6 children visit to see it. Then 2 children go home. How many children are still looking at the painting?",
                    answers: ["3", "4", "5", "6"],
                    correct: 1
                },
                {
                    question: "Butterflies have colorful wings! In a garden near the Eiffel Tower, there are 3 blue butterflies and 4 orange butterflies. How many butterflies are there in all?",
                    answers: ["5", "6", "7", "8"],
                    correct: 2
                }
            ],
            // Slot 4: Counting and patterns
            [
                {
                    question: "What number comes next? 2, 4, 6, ___",
                    answers: ["7", "8", "9", "10"],
                    correct: 1
                },
                {
                    question: "What number comes next? 5, 6, 7, ___",
                    answers: ["6", "7", "8", "9"],
                    correct: 2
                },
                {
                    question: "What number comes next? 1, 3, 5, ___",
                    answers: ["6", "7", "8", "9"],
                    correct: 1
                },
                {
                    question: "Count by 2s: 2, 4, ___, 8",
                    answers: ["5", "6", "7", "9"],
                    correct: 1
                },
                {
                    question: "What number is between 6 and 8?",
                    answers: ["5", "6", "7", "9"],
                    correct: 2
                }
            ],
            // Slot 5: Comparing numbers
            [
                {
                    question: "Which number is bigger: 7 or 4?",
                    answers: ["7", "4", "They are equal", "Cannot tell"],
                    correct: 0
                },
                {
                    question: "Which number is smaller: 3 or 8?",
                    answers: ["3", "8", "They are equal", "Cannot tell"],
                    correct: 0
                },
                {
                    question: "Which number is bigger: 5 or 9?",
                    answers: ["5", "9", "They are equal", "Cannot tell"],
                    correct: 1
                },
                {
                    question: "Which number is smaller: 6 or 2?",
                    answers: ["6", "2", "They are equal", "Cannot tell"],
                    correct: 1
                },
                {
                    question: "Are these equal? 4 + 1 and 5",
                    answers: ["Yes, they are equal", "No, 4 + 1 is bigger", "No, 5 is bigger", "Cannot tell"],
                    correct: 0
                }
            ]
        ];

        function selectRandomQuestions() {
            // Select one random question from each slot
            selectedReadingQuestions = readingQuestionPool.map(slot =>
                slot[Math.floor(Math.random() * slot.length)]
            );
            selectedMathQuestions = mathQuestionPool.map(slot =>
                slot[Math.floor(Math.random() * slot.length)]
            );
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function startGame() {
            currentQuestion = 0;
            currentChallenge = 'reading';
            readingScore = 0;
            mathScore = 0;

            // Select new random questions for this game
            selectRandomQuestions();

            const questionScreen = document.getElementById('question-screen');
            questionScreen.classList.remove('question-screen-math');
            questionScreen.classList.add('question-screen-reading');

            showScreen('question-screen');
            loadQuestion();
        }

        function startMathChallenge() {
            currentQuestion = 0;
            currentChallenge = 'math';

            const questionScreen = document.getElementById('question-screen');
            questionScreen.classList.remove('question-screen-reading');
            questionScreen.classList.add('question-screen-math');

            document.getElementById('helper-icon').innerHTML = '<img src="images/dwarf.png" alt="Dwarf">';

            showScreen('question-screen');
            loadQuestion();
        }

        function loadQuestion() {
            answeredCurrent = false;
            const questions = currentChallenge === 'reading' ? selectedReadingQuestions : selectedMathQuestions;
            const question = questions[currentQuestion];

            // Update UI
            document.getElementById('challenge-title').textContent =
                currentChallenge === 'reading' ? 'The Royal Library' : 'The Royal Treasury';

            document.getElementById('question-counter').textContent =
                `Question ${currentQuestion + 1} of 5`;

            // Update progress bar (0-10 total questions)
            const totalProgress = currentChallenge === 'reading' ? currentQuestion : currentQuestion + 5;
            document.getElementById('progress-fill').style.width = `${totalProgress * 10}%`;

            document.getElementById('question-text').textContent = question.question;

            // Update helper icon
            document.getElementById('helper-icon').innerHTML =
                `<img src="images/${currentChallenge === 'reading' ? 'owl' : 'dwarf'}.png" alt="Helper">`;

            // Create answer buttons
            const container = document.getElementById('answers-container');
            container.innerHTML = '';

            question.answers.forEach((answer, index) => {
                const btn = document.createElement('button');
                btn.className = 'btn btn-answer';
                btn.textContent = answer;
                btn.onclick = () => selectAnswer(index);
                container.appendChild(btn);
            });
        }

        function selectAnswer(index) {
            if (answeredCurrent) return;
            answeredCurrent = true;

            const questions = currentChallenge === 'reading' ? selectedReadingQuestions : selectedMathQuestions;
            const question = questions[currentQuestion];
            const buttons = document.querySelectorAll('.btn-answer');

            // Show correct/incorrect
            buttons.forEach((btn, i) => {
                btn.style.pointerEvents = 'none';
                if (i === question.correct) {
                    btn.classList.add('correct');
                } else if (i === index && index !== question.correct) {
                    btn.classList.add('incorrect');
                }
            });

            // Update score
            if (index === question.correct) {
                if (currentChallenge === 'reading') {
                    readingScore++;
                } else {
                    mathScore++;
                }
            }

            // Move to next question after delay
            setTimeout(() => {
                currentQuestion++;

                if (currentQuestion >= 5) {
                    if (currentChallenge === 'reading') {
                        // Show transition screen
                        document.getElementById('reading-score-display').textContent =
                            `${readingScore} out of 5`;
                        showScreen('transition-screen');
                    } else {
                        // Show final results
                        showResults();
                    }
                } else {
                    loadQuestion();
                }
            }, 1500);
        }

        function showResults() {
            const totalScore = readingScore + mathScore;
            let medalType, medalText, celebration, medalImage;

            if (totalScore >= 8) {
                medalType = 'gold';
                medalText = 'Gold Medal!';
                celebration = 'üèÜ ‚ú® üéâ';
                medalImage = 'images/gold-medal.png';
                setTimeout(playVictoryMusic, 300);
            } else if (totalScore >= 5) {
                medalType = 'silver';
                medalText = 'Silver Medal!';
                celebration = 'ü•à üéâ';
                medalImage = 'images/silver-medal.png';
                setTimeout(playVictoryMusic, 300);
            } else if (totalScore >= 3) {
                medalType = 'bronze';
                medalText = 'Bronze Medal!';
                celebration = 'ü•â üëè';
                medalImage = 'images/bronze-medal.png';
                setTimeout(playOkayMusic, 300);
            } else {
                medalType = 'no-medal';
                medalText = 'Keep Practicing!';
                celebration = '‚≠ê üí™';
                medalImage = 'images/star-ribbon.png';
                setTimeout(playSadMusic, 300);
            }

            const resultsScreen = document.getElementById('results-screen');
            resultsScreen.className = `screen ${medalType}`;

            document.getElementById('celebration').textContent = celebration;
            document.getElementById('final-score').textContent = `You scored ${totalScore} out of 10!`;
            document.getElementById('score-breakdown').textContent = `Reading: ${readingScore}/5 | Math: ${mathScore}/5`;
            document.getElementById('medal-text').textContent = medalText;
            document.getElementById('medal-image').src = medalImage;

            showScreen('results-screen');
        }

        function restartGame() {
            const questionScreen = document.getElementById('question-screen');
            questionScreen.classList.remove('question-screen-math');
            questionScreen.classList.add('question-screen-reading');
            document.getElementById('helper-icon').innerHTML = '<img src="images/owl.png" alt="Owl">';
            showScreen('title-screen');
        }
    </script>
</body>
</html>
